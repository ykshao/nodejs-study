(function(g){var n,l,G="",e="4.1.0",y=Math.PI,i=y/2,m="ontouchstart" in window,s=(m)?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},z={backward:[],forward:["br"],all:["br"]},j=["single","double"],r=["ltr","rtl"],d={acceleration:true,display:"double",duration:600,page:1,gradients:true,turnCorners:"bl,br",when:null},a={cornerSize:400},C=6,D={init:function(I){n="WebKitCSSMatrix" in window||"MozPerspective" in document.body.style;l=F();G=x();var J,L=this,N=0,M=this.data(),K=this.children();I=g.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},d,I);M.opts=I;M.pageObjs={};M.pages={};M.pageWrap={};M.pageZoom={};M.pagePlace={};M.pageMv=[];M.zoom=1;M.totalPages=I.pages||0;M.eventHandlers={touchStart:g.proxy(D._touchStart,this),touchMove:g.proxy(D._touchMove,this),touchEnd:g.proxy(D._touchEnd,this),start:g.proxy(D._eventStart,this)};if(I.when){for(J in I.when){if(c(J,I.when)){this.bind(J,I.when[J])}}}this.css({position:"relative",width:I.width,height:I.height});this.turn("display",I.display);if(I.direction!==""){this.turn("direction",I.direction)}if(n&&!m&&I.acceleration){this.transform(o(0,0,true))}for(J=0;J<K.length;J++){if(g(K[J]).attr("ignore")!="1"){this.turn("addPage",K[J],++N)}}g(this).bind(s.down,M.eventHandlers.touchStart).bind("end",D._eventEnd).bind("pressed",D._eventPressed).bind("released",D._eventReleased).bind("flip",D._flip);g(this).parent().bind("start",M.eventHandlers.start);g(document).bind(s.move,M.eventHandlers.touchMove).bind(s.up,M.eventHandlers.touchEnd);this.turn("page",I.page);M.done=true;return this},addPage:function(I,O){var L,K,J=false,N=this.data(),M=N.totalPages+1;if(N.destroying){return false}if((L=/\bp([0-9]+)\b/.exec(g(I).attr("class")))){O=parseInt(L[1],10)}if(O){if(O==M){J=true}else{if(O>M){throw E('Page "'+O+'" cannot be inserted')}}}else{O=M;J=true}if(O>=1&&O<=M){if(N.display=="double"){K=(O%2)?" odd":" even"}else{K=""}if(N.done){this.turn("stop")}if(O in N.pageObjs){D._movePages.call(this,O,1)}if(J){N.totalPages=M}N.pageObjs[O]=g(I).css({"float":"left"}).addClass("page p"+O+K);if(!k()&&N.pageObjs[O].hasClass("hard")){N.pageObjs[O].removeClass("hard")}D._addPage.call(this,O);D._removeFromDOM.call(this)}return this},_addPage:function(K){var J=this.data(),I=J.pageObjs[K];if(I){if(D._necessPage.call(this,K)){if(!J.pageWrap[K]){J.pageWrap[K]=g("<div/>",{"class":"page-wrapper",page:K,css:{position:"absolute",overflow:"hidden"}});this.append(J.pageWrap[K]);if(!J.pagePlace[K]){J.pagePlace[K]=K;J.pageObjs[K].appendTo(J.pageWrap[K])}var L=D._pageSize.call(this,K,true);I.css({width:L.width,height:L.height});J.pageWrap[K].css(L)}if(J.pagePlace[K]==K){D._makeFlip.call(this,K)}}else{J.pagePlace[K]=0;if(J.pageObjs[K]){J.pageObjs[K].remove()}}}},hasPage:function(I){return c(I,this.data().pageObjs)},center:function(L){var K=this.data(),J=g(this).turn("size"),M=0;if(!K.noCenter){if(K.display=="double"){var I=this.turn("view",L||K.tpage||K.page);if(K.direction=="ltr"){if(!I[0]){M-=J.width/4}else{if(!I[1]){M+=J.width/4}}}else{if(!I[0]){M+=J.width/4}else{if(!I[1]){M-=J.width/4}}}}g(this).css({marginLeft:M})}return this},destroy:function(){var L,I=this,K=this.data(),J=["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing"];if(u("destroying",this)=="prevented"){return}K.destroying=true;g.each(J,function(N,M){I.unbind(M)});this.parent().unbind("start",K.eventHandlers.start);g(document).unbind(s.move,K.eventHandlers.touchMove).unbind(s.up,K.eventHandlers.touchEnd);while(K.totalPages!==0){this.turn("removePage",K.totalPages)}if(K.fparent){K.fparent.remove()}if(K.shadow){K.shadow.remove()}this.removeData();K=null;return this},is:function(){return typeof(this.data().pages)=="object"},zoom:function(L){var N=this.data();if(typeof(L)=="number"){if(L<0.001||L>100){throw E(L+" is not a value for zoom")}if(u("zooming",this,[L,N.zoom])=="prevented"){return this}var K=this.turn("size"),P=this.turn("view"),O=1/N.zoom,M=Math.round(K.width*O*L),I=Math.round(K.height*O*L);N.zoom=L;g(this).turn("stop").turn("size",M,I);if(N.opts.autoCenter){this.turn("center")}D._updateShadow.call(this);for(var J=0;J<P.length;J++){if(P[J]&&N.pageZoom[P[J]]!=N.zoom){this.trigger("zoomed",[P[J],P,N.pageZoom[P[J]],N.zoom]);N.pageZoom[P[J]]=N.zoom}}return this}else{return N.zoom}},_pageSize:function(N,I){var M=this.data(),O={};if(M.display=="single"){O.width=this.width();O.height=this.height();if(I){O.top=0;O.left=0;O.right="auto"}}else{var J=this.width()/2,K=this.height();if(M.pageObjs[N].hasClass("own-size")){O.width=M.pageObjs[N].width();O.height=M.pageObjs[N].height()}else{O.width=J;O.height=K}if(I){var L=N%2;O.top=(K-O.height)/2;if(M.direction=="ltr"){O[(L)?"right":"left"]=J-O.width;O[(L)?"left":"right"]="auto"}else{O[(L)?"left":"right"]=J-O.width;O[(L)?"right":"left"]="auto"}}}return O},_makeFlip:function(K){var J=this.data();if(!J.pages[K]&&J.pagePlace[K]==K){var L=J.display=="single",I=K%2;J.pages[K]=J.pageObjs[K].css(D._pageSize.call(this,K)).flip({page:K,next:(I||L)?K+1:K-1,turn:this}).flip("disable",J.disabled);D._setPageLoc.call(this,K);J.pageZoom[K]=J.zoom}return J.pages[K]},_makeRange:function(){var K,I,J=this.data();if(J.totalPages<1){return}I=this.turn("range");for(K=I[0];K<=I[1];K++){D._addPage.call(this,K)}},range:function(M){var I,N,K,J,L=this.data();M=M||L.tpage||L.page||1;J=D._view.call(this,M);if(M<1||M>L.totalPages){throw E('"'+M+'" is not a valid page')}J[1]=J[1]||J[0];if(J[0]>=1&&J[1]<=L.totalPages){I=Math.floor((C-2)/2);if(L.totalPages-J[1]>J[0]){N=Math.min(J[0]-1,I);K=2*I-N}else{K=Math.min(L.totalPages-J[1],I);N=2*I-K}}else{N=C-1;K=C-1}return[Math.max(1,J[0]-N),Math.min(L.totalPages,J[1]+K)]},_necessPage:function(J){if(J===0){return true}var I=this.turn("range");return this.data().pageObjs[J].hasClass("fixed")||(J>=I[0]&&J<=I[1])},_removeFromDOM:function(){var J,I=this.data();for(J in I.pageWrap){if(c(J,I.pageWrap)&&!D._necessPage.call(this,J)){D._removePageFromDOM.call(this,J)}}},_removePageFromDOM:function(K){var J=this.data();if(J.pages[K]){var I=J.pages[K].data();A._moveFoldingPage.call(J.pages[K],false);if(I.f&&I.f.fwrapper){I.f.fwrapper.remove()}J.pages[K].removeData();J.pages[K].remove();delete J.pages[K]}if(J.pageObjs[K]){J.pageObjs[K].remove()}if(J.pageWrap[K]){J.pageWrap[K].remove();delete J.pageWrap[K]}D._removeMv.call(this,K);delete J.pagePlace[K];delete J.pageZoom[K]},removePage:function(J){var I=this.data();if(J=="*"){while(I.totalPages!==0){this.turn("removePage",I.totalPages)}}else{if(J<1||J>I.totalPages){throw E("The page "+J+" doesn't exist")}if(I.pageObjs[J]){this.turn("stop");D._removePageFromDOM.call(this,J);delete I.pageObjs[J]}D._movePages.call(this,J,-1);I.totalPages=I.totalPages-1;if(I.page>I.totalPages){I.page=null;D._fitPage.call(this,I.totalPages)}else{D._makeRange.call(this);this.turn("update")}}return this},_movePages:function(O,N){var L,J=this,K=this.data(),M=K.display=="single",I=function(S){var Q=S+N,R=Q%2,P=(R)?" odd ":" even ";if(K.pageObjs[S]){K.pageObjs[Q]=K.pageObjs[S].removeClass("p"+S+" odd even").addClass("p"+Q+P)}if(K.pagePlace[S]&&K.pageWrap[S]){K.pagePlace[Q]=Q;if(K.pageObjs[Q].hasClass("fixed")){K.pageWrap[Q]=K.pageWrap[S].attr("page",Q)}else{K.pageWrap[Q]=K.pageWrap[S].css(D._pageSize.call(J,Q,true)).attr("page",Q)}if(K.pages[S]){K.pages[Q]=K.pages[S].flip("options",{page:Q,next:(M||R)?Q+1:Q-1})}if(N){delete K.pages[S];delete K.pagePlace[S];delete K.pageZoom[S];delete K.pageObjs[S];delete K.pageWrap[S]}}};if(N>0){for(L=K.totalPages;L>=O;L--){I(L)}}else{for(L=O;L<=K.totalPages;L++){I(L)}}},display:function(K){var J=this.data(),L=J.display;if(K===undefined){return L}else{if(g.inArray(K,j)==-1){throw E('"'+K+'" is not a value for display')}switch(K){case"single":if(!J.pageObjs[0]){this.turn("stop").css({overflow:"hidden"});J.pageObjs[0]=g("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)}this.addClass("shadow");break;case"double":if(J.pageObjs[0]){this.turn("stop").css({overflow:""});J.pageObjs[0].remove();delete J.pageObjs[0]}this.removeClass("shadow");break}J.display=K;if(L){var I=this.turn("size");D._movePages.call(this,1,0);this.turn("size",I.width,I.height).turn("update")}return this}},direction:function(I){var J=this.data();if(I===undefined){return J.direction}else{I=I.toLowerCase();if(g.inArray(I,r)==-1){throw E('"'+I+'" is not a value for direction')}if(I=="rtl"){g(this).attr("dir","ltr").css({direction:"ltr"})}J.direction=I;if(J.done){this.turn("size",g(this).width(),g(this).height())}return this}},animating:function(){return this.data().pageMv.length>0},corner:function(){var I,K,J=this.data();for(K in J.pages){if(c(K,J.pages)){if((I=J.pages[K].flip("corner"))){return I}}}return false},data:function(){return this.data()},disable:function(J){var L,K=this.data(),I=this.turn("view");K.disabled=J===undefined||J===true;for(L in K.pages){if(c(L,K.pages)){K.pages[L].flip("disable",(K.disabled)?true:g.inArray(parseInt(L,10),I)==-1)}}return this},disabled:function(I){if(I===undefined){return this.data().disabled===true}else{return this.turn("disable",I)}},size:function(K,I){if(K===undefined||I===undefined){return{width:this.width(),height:this.height()}}else{this.turn("stop");var M,N,L=this.data(),J=(L.display=="double")?K/2:K;this.css({width:K,height:I});if(L.pageObjs[0]){L.pageObjs[0].css({width:J,height:I})}for(M in L.pageWrap){if(!c(M,L.pageWrap)){continue}N=D._pageSize.call(this,M,true);L.pageObjs[M].css({width:N.width,height:N.height});L.pageWrap[M].css(N);if(L.pages[M]){L.pages[M].css({width:N.width,height:N.height})}}this.turn("resize");return this}},resize:function(){var J,I=this.data();if(I.pages[0]){I.pageWrap[0].css({left:-this.width()});I.pages[0].flip("resize",true)}for(J=1;J<=I.totalPages;J++){if(I.pages[J]){I.pages[J].flip("resize",true)}}D._updateShadow.call(this);if(I.opts.autoCenter){this.turn("center")}},_removeMv:function(K){var I,J=this.data();for(I=0;I<J.pageMv.length;I++){if(J.pageMv[I]==K){J.pageMv.splice(I,1);return true}}return false},_addMv:function(J){var I=this.data();D._removeMv.call(this,J);I.pageMv.push(J)},_view:function(J){var I=this.data();J=J||I.page;if(I.display=="double"){return(J%2)?[J-1,J]:[J,J+1]}else{return[J]}},view:function(K){var J=this.data(),I=D._view.call(this,K);if(J.display=="double"){return[(I[0]>0)?I[0]:0,(I[1]<=J.totalPages)?I[1]:0]}else{return[(I[0]>0&&I[0]<=J.totalPages)?I[0]:0]}},stop:function(N,I){if(this.turn("animating")){var J,K,M,L=this.data();if(L.tpage){L.page=L.tpage;delete L.tpage}for(J=0;J<L.pageMv.length;J++){if(!L.pageMv[J]||L.pageMv[J]===N){continue}M=L.pages[L.pageMv[J]];K=M.data().f.opts;M.flip("hideFoldedPage",I);if(!I){A._moveFoldingPage.call(M,false)}if(K.force){K.next=(K.page%2===0)?K.page-1:K.page+1;delete K.force}}}this.turn("update");return this},pages:function(I){var K=this.data();if(I){if(I<K.totalPages){for(var J=K.totalPages;J>I;J--){this.turn("removePage",J)}}K.totalPages=I;D._fitPage.call(this,K.page);return this}else{return K.totalPages}},_missing:function(L){var K=this.data();if(K.totalPages<1){return}var M,I=this.turn("range",L),J=[];for(M=I[0];M<=I[1];M++){if(!K.pageObjs[M]){J.push(M)}}if(J.length>0){this.trigger("missing",[J])}},_fitPage:function(K){var J=this.data(),L=this.turn("view",K);D._missing.call(this,K);if(!J.pageObjs[K]){return}J.page=K;this.turn("stop");for(var I=0;I<L.length;I++){if(L[I]&&J.pageZoom[L[I]]!=J.zoom){this.trigger("zoomed",[L[I],L,J.pageZoom[L[I]],J.zoom]);J.pageZoom[L[I]]=J.zoom}}D._removeFromDOM.call(this);D._makeRange.call(this);D._updateShadow.call(this);this.trigger("turned",[K,L]);this.turn("update");if(J.opts.autoCenter){this.turn("center")}},_turnPage:function(R){var Q,N,M=this.data(),K=M.pagePlace[R],S=this.turn("view"),J=this.turn("view",R);if(M.page!=R){var P=M.page;if(u("turning",this,[R,J])=="prevented"){if(P==M.page&&g.inArray(K,M.pageMv)!=-1){M.pages[K].flip("hideFoldedPage",true)}return}if(g.inArray(1,J)!=-1){this.trigger("first")}if(g.inArray(M.totalPages,J)!=-1){this.trigger("last")}}if(M.display=="single"){Q=S[0];N=J[0]}else{if(S[1]&&R>S[1]){Q=S[1];N=J[0]}else{if(S[0]&&R<S[0]){Q=S[0];N=J[1]}}}var O=M.opts.turnCorners.split(","),L=M.pages[Q].data().f,I=L.opts,T=L.point;D._missing.call(this,R);if(!M.pageObjs[R]){return}this.turn("stop");M.page=R;D._makeRange.call(this);M.tpage=N;if(I.next!=N){I.next=N;I.force=true}this.turn("update");L.point=T;if(L.effect=="hard"){if(M.direction=="ltr"){M.pages[Q].flip("turnPage",(R>Q)?"r":"l")}else{M.pages[Q].flip("turnPage",(R>Q)?"l":"r")}}else{if(M.direction=="ltr"){M.pages[Q].flip("turnPage",O[(R>Q)?1:0])}else{M.pages[Q].flip("turnPage",O[(R>Q)?0:1])}}},page:function(J){var I=this.data();if(J===undefined){return I.page}else{if(!I.disabled&&!I.destroying){J=parseInt(J,10);if(J>0&&J<=I.totalPages){if(J!=I.page){if(!I.done||g.inArray(J,this.turn("view"))!=-1){D._fitPage.call(this,J)}else{D._turnPage.call(this,J)}}return this}else{throw E("The page "+J+" does not exist")}}}},next:function(){return this.turn("page",Math.min(this.data().totalPages,D._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,D._view.call(this,this.data().page).shift()-1))},peel:function(K,J){var M=this.data(),I=this.turn("view");J=(J===undefined)?true:J===true;if(K===false){this.turn("stop",null,J)}else{if(M.display=="single"){M.pages[M.page].flip("peel",K,J)}else{var L;if(M.direction=="ltr"){L=(K.indexOf("l")!=-1)?I[0]:I[1]}else{L=(K.indexOf("l")!=-1)?I[1]:I[0]}if(M.pages[L]){M.pages[L].flip("peel",K,J)}}}return this},_addMotionPage:function(){var K=g(this).data().f.opts,J=K.turn,I=J.data();D._addMv.call(J,K.page)},_eventStart:function(M,J,I){var L=J.turn.data(),K=L.pageZoom[J.page];if(M.isDefaultPrevented()){D._updateShadow.call(J.turn);return}if(K&&K!=L.zoom){J.turn.trigger("zoomed",[J.page,J.turn.turn("view",J.page),K,L.zoom]);L.pageZoom[J.page]=L.zoom}if(L.display=="single"&&I){if((I.charAt(1)=="l"&&L.direction=="ltr")||(I.charAt(1)=="r"&&L.direction=="rtl")){J.next=(J.next<J.page)?J.next:J.page-1;J.force=true}else{J.next=(J.next>J.page)?J.next:J.page+1}}D._addMotionPage.call(M.target);D._updateShadow.call(J.turn)},_eventEnd:function(O,M,L){var K=g(O.target),N=K.data().f,J=M.turn,I=J.data();if(L){var P=I.tpage||I.page;if(P==M.next||P==M.page){delete I.tpage;D._fitPage.call(J,P||M.next,true)}}else{D._removeMv.call(J,M.page);D._updateShadow.call(J);J.turn("update")}},_eventPressed:function(N){var M,L=g(N.target).data().f,K=L.opts.turn,J=K.data(),I=J.pages;J.mouseAction=true;K.turn("update");return L.time=new Date().getTime()},_eventReleased:function(O,I){var N,M=g(O.target),L=M.data().f,K=L.opts.turn,J=K.data();if(J.display=="single"){N=(I.corner=="br"||I.corner=="tr")?I.x<M.width()/2:I.x>M.width()/2}else{N=I.x<0||I.x>M.width()}if((new Date()).getTime()-L.time<200||N){O.preventDefault();D._turnPage.call(K,L.opts.next)}J.mouseAction=false},_flip:function(J){J.stopPropagation();var I=g(J.target).data().f.opts;I.turn.trigger("turn",[I.next]);if(I.turn.data().opts.autoCenter){I.turn.turn("center",I.next)}},_touchStart:function(){var J=this.data();for(var I in J.pages){if(c(I,J.pages)&&A._eventStart.apply(J.pages[I],arguments)===false){return false}}},_touchMove:function(){var J=this.data();for(var I in J.pages){if(c(I,J.pages)){A._eventMove.apply(J.pages[I],arguments)}}},_touchEnd:function(){var J=this.data();for(var I in J.pages){if(c(I,J.pages)){A._eventEnd.apply(J.pages[I],arguments)}}},calculateZ:function(U){var L,O,S,J,T,N=this,K=this.data(),R=this.turn("view"),M=R[0]||R[1],Q=U.length-1,I={pageZ:{},partZ:{},pageV:{}},P=function(W){var V=N.turn("view",W);if(V[0]){I.pageV[V[0]]=true}if(V[1]){I.pageV[V[1]]=true}};for(L=0;L<=Q;L++){O=U[L];S=K.pages[O].data().f.opts.next;J=K.pagePlace[O];P(O);P(S);T=(K.pagePlace[S]==S)?S:O;I.pageZ[T]=K.totalPages-Math.abs(M-T);I.partZ[J]=K.totalPages*2-Q+L}return I},update:function(){var O,M=this.data();if(this.turn("animating")&&M.pageMv[0]!==0){var I,J,L,P=this.turn("calculateZ",M.pageMv),R=this.turn("corner"),Q=this.turn("view"),K=this.turn("view",M.tpage);for(O in M.pageWrap){if(!c(O,M.pageWrap)){continue}L=M.pageObjs[O].hasClass("fixed");M.pageWrap[O].css({display:(P.pageV[O]||L)?"":"none",zIndex:(M.pageObjs[O].hasClass("hard")?P.partZ[O]:P.pageZ[O])||(L?-1:0)});if((I=M.pages[O])){I.flip("z",P.partZ[O]||null);if(P.pageV[O]){I.flip("resize")}if(M.tpage){I.flip("hover",false).flip("disable",g.inArray(parseInt(O,10),M.pageMv)==-1&&O!=K[0]&&O!=K[1])}else{I.flip("hover",R===false).flip("disable",O!=Q[0]&&O!=Q[1])}}}}else{for(O in M.pageWrap){if(!c(O,M.pageWrap)){continue}var N=D._setPageLoc.call(this,O);if(M.pages[O]){M.pages[O].flip("disable",M.disabled||N!=1).flip("hover",true).flip("z",null)}}}return this},_updateShadow:function(){var K,J,P,O=this.data(),N=this.width(),I=this.height(),L=(O.display=="single")?N:N/2;K=this.turn("view");if(!O.shadow){O.shadow=g("<div />",{"class":"shadow",css:t(0,0,0).css}).appendTo(this)}for(var M=0;M<O.pageMv.length;M++){if(!K[0]||!K[1]){break}K=this.turn("view",O.pages[O.pageMv[M]].data().f.opts.next);J=this.turn("view",O.pageMv[M]);K[0]=K[0]&&J[0];K[1]=K[1]&&J[1]}if(!K[0]){P=(O.direction=="ltr")?1:2}else{if(!K[1]){P=(O.direction=="ltr")?2:1}else{P=3}}switch(P){case 1:O.shadow.css({width:L,height:I,top:0,left:L});break;case 2:O.shadow.css({width:L,height:I,top:0,left:0});break;case 3:O.shadow.css({width:N,height:I,top:0,left:0});break}},_setPageLoc:function(K){var J=this.data(),I=this.turn("view"),L=0;if(K==I[0]||K==I[1]){L=1}else{if((J.display=="single"&&K==I[0]+1)||(J.display=="double"&&K==I[0]-2||K==I[1]+2)){L=2}}if(!this.turn("animating")){switch(L){case 1:J.pageWrap[K].css({zIndex:J.totalPages,display:""});break;case 2:J.pageWrap[K].css({zIndex:J.totalPages-1,display:""});break;case 0:J.pageWrap[K].css({zIndex:0,display:(J.pageObjs[K].hasClass("fixed"))?"":"none"});break}}return L},options:function(J){if(J===undefined){return this.data().opts}else{var K=this.data();g.extend(K.opts,J);if(J.pages){this.turn("pages",J.pages)}if(J.page){this.turn("page",J.page)}if(J.display){this.turn("display",J.display)}if(J.direction){this.turn("direction",J.direction)}if(J.width&&J.height){this.turn("size",J.width,J.height)}if(J.when){for(var I in J.when){if(c(I,J.when)){this.unbind(I).bind(I,J.when[I])}}}return this}},version:function(){return e}},A={init:function(I){this.data({f:{disabled:false,hover:false,effect:(this.hasClass("hard"))?"hard":"sheet"}});this.flip("options",I);A._addPageWrapper.call(this);return this},setData:function(J){var I=this.data();I.f=g.extend(I.f,J);return this},options:function(I){var J=this.data().f;if(I){A.setData.call(this,{opts:g.extend({},J.opts||a,I)});return this}else{return J.opts}},z:function(J){var I=this.data().f;I.opts["z-index"]=J;if(I.fwrapper){I.fwrapper.css({zIndex:J||parseInt(I.parent.css("z-index"),10)||0})}return this},_cAllowed:function(){var L=this.data().f,K=L.opts.page,I=L.opts.turn.data(),J=K%2;if(L.effect=="hard"){return(I.direction=="ltr")?[(J)?"r":"l"]:[(J)?"l":"r"]}else{if(I.display=="single"){if(K==1){return(I.direction=="ltr")?z.forward:z.backward}else{if(K==I.totalPages){return(I.direction=="ltr")?z.backward:z.forward}else{return z.all}}}else{return(I.direction=="ltr")?z[(J)?"forward":"backward"]:z[(J)?"backward":"forward"]}}},_cornerActivated:function(O){var M=this.data().f,L=this.width(),K=this.height(),J={x:O.x,y:O.y,corner:""},N=M.opts.cornerSize;if(J.x<=0||J.y<=0||J.x>=L||J.y>=K){return false}var I=A._cAllowed.call(this);switch(M.effect){case"hard":if(J.x>L-N){J.corner="r"}else{if(J.x<N){J.corner="l"}else{return false}}break;case"sheet":if(J.y<N){J.corner+="t"}else{if(J.y>=K-N){J.corner+="b"}else{return false}}if(J.x<=N){J.corner+="l"}else{if(J.x>=L-N){J.corner+="r"}else{return false}}break}return(!J.corner||g.inArray(J.corner,I)==-1)?false:J},_isIArea:function(I){var J=this.data().f.parent.offset();I=(m&&I.originalEvent)?I.originalEvent.touches[0]:I;return A._cornerActivated.call(this,{x:I.pageX-J.left,y:I.pageY-J.top})},_c:function(J,I){I=I||0;switch(J){case"tl":return h(I,I);case"tr":return h(this.width()-I,I);case"bl":return h(I,this.height()-I);case"br":return h(this.width()-I,this.height()-I);case"l":return h(I,0);case"r":return h(this.width()-I,0)}},_c2:function(I){switch(I){case"tl":return h(this.width()*2,0);case"tr":return h(-this.width(),0);case"bl":return h(this.width()*2,this.height());case"br":return h(-this.width(),this.height());case"l":return h(this.width()*2,0);case"r":return h(-this.width(),0)}},_foldingPage:function(){var J=this.data().f;if(!J){return}var I=J.opts;if(I.turn){J=I.turn.data();if(J.display=="single"){return(I.next>1||I.page>1)?J.pageObjs[0]:null}else{return J.pageObjs[I.next]}}},_backGradient:function(){var J=this.data().f,I=J.opts.turn.data(),K=I.opts.gradients&&(I.display=="single"||(J.opts.page!=2&&J.opts.page!=I.totalPages-1));if(K&&!J.bshadow){J.bshadow=g("<div/>",t(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(J.parent)}return K},type:function(){return this.data().f.effect},resize:function(L){var N=this.data().f,K=N.opts.turn.data(),M=this.width(),I=this.height();switch(N.effect){case"hard":if(L){N.wrapper.css({width:M,height:I});N.fpage.css({width:M,height:I});if(K.opts.gradients){N.ashadow.css({width:M,height:I});N.bshadow.css({width:M,height:I})}}break;case"sheet":if(L){var J=Math.round(Math.sqrt(Math.pow(M,2)+Math.pow(I,2)));N.wrapper.css({width:J,height:J});N.fwrapper.css({width:J,height:J}).children(":first-child").css({width:M,height:I});N.fpage.css({width:M,height:I});if(K.opts.gradients){N.ashadow.css({width:M,height:I})}if(A._backGradient.call(this)){N.bshadow.css({width:M,height:I})}}if(N.parent.is(":visible")){var O=w(N.parent[0]);N.fwrapper.css({top:O.top,left:O.left});O=w(N.opts.turn[0]);N.fparent.css({top:-O.top,left:-O.left})}this.flip("z",N.opts["z-index"]);break}},_addPageWrapper:function(){var L,K=this.data().f,O=K.opts.turn.data(),M=this.parent();K.parent=M;if(!K.wrapper){switch(K.effect){case"hard":var P={};P[G+"transform-style"]="preserve-3d";P[G+"backface-visibility"]="hidden";K.wrapper=g("<div/>",t(0,0,2)).css(P).appendTo(M).prepend(this);K.fpage=g("<div/>",t(0,0,1)).css(P).appendTo(M);if(O.opts.gradients){K.ashadow=g("<div/>",t(0,0,0)).hide().appendTo(M);K.bshadow=g("<div/>",t(0,0,0))}break;case"sheet":var J=this.width(),N=this.height(),Q=Math.round(Math.sqrt(Math.pow(J,2)+Math.pow(N,2)));K.fparent=K.opts.turn.data().fparent;if(!K.fparent){var I=g("<div/>",{css:{"pointer-events":"none"}}).hide();I.data().flips=0;I.css(t(0,0,"auto","visible").css).appendTo(K.opts.turn);K.opts.turn.data().fparent=I;K.fparent=I}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});K.wrapper=g("<div/>",t(0,0,this.css("z-index"))).appendTo(M).prepend(this);K.fwrapper=g("<div/>",t(M.offset().top,M.offset().left)).hide().appendTo(K.fparent);K.fpage=g("<div/>",t(0,0,0,"visible")).css({cursor:"default"}).appendTo(K.fwrapper);if(O.opts.gradients){K.ashadow=g("<div/>",t(0,0,1)).appendTo(K.fpage)}A.setData.call(this,K);break}}A.resize.call(this,true)},_fold:function(ac){var ar=this.data().f,ap=ar.opts.turn.data(),ak=A._c.call(this,ac.corner),I=this.width(),J=this.height();switch(ar.effect){case"hard":if(ac.corner=="l"){ac.x=Math.min(Math.max(ac.x,0),I*2)}else{ac.x=Math.max(Math.min(ac.x,I),-I)}var X,ad,am,aj,ab,S=ap.totalPages,V=ar.opts["z-index"]||S,ag={overflow:"visible"},aq=(ak.x)?(ak.x-ac.x)/I:ac.x/I,W=aq*90,L=W<90;switch(ac.corner){case"l":aj="0% 50%";ab="100% 50%";if(L){X=0;ad=ar.opts.next-1>0;am=1}else{X="100%";ad=ar.opts.page+1<S;am=0}break;case"r":aj="100% 50%";ab="0% 50%";W=-W;I=-I;if(L){X=0;ad=ar.opts.next+1<S;am=0}else{X="-100%";ad=ar.opts.page!=1;am=1}break}ag[G+"perspective-origin"]=ab;ar.wrapper.transform("rotateY("+W+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",ab);ar.fpage.transform("translateX("+I+"px) rotateY("+(180+W)+"deg)",aj);ar.parent.css(ag);if(L){aq=-aq+1;ar.wrapper.css({zIndex:V+1});ar.fpage.css({zIndex:V})}else{aq=aq-1;ar.wrapper.css({zIndex:V});ar.fpage.css({zIndex:V+1})}if(ap.opts.gradients){if(ad){ar.ashadow.css({display:"",left:X,backgroundColor:"rgba(0,0,0,"+(0.5*aq)+")"}).transform("rotateY(0deg)")}else{ar.ashadow.hide()}ar.bshadow.css({opacity:-aq+1});if(L){if(ar.bshadow.parent()[0]!=ar.wrapper[0]){ar.bshadow.appendTo(ar.wrapper)}}else{if(ar.bshadow.parent()[0]!=ar.fpage[0]){ar.bshadow.appendTo(ar.fpage)}}b(ar.bshadow,h(am*100,0),h((-am+1)*100,0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2)}break;case"sheet":var af=this,au=0,al=0,ae,Q,N,M,av,Z,aa,ah,P=h(0,0),T=h(0,0),at=h(0,0),an=A._foldingPage.call(this),ai=Math.tan(al),U=ap.opts.acceleration,ao=ar.wrapper.height(),O=ac.corner.substr(0,1)=="t",K=ac.corner.substr(1,1)=="l",R=function(){var aG=h(0,0);var aH=h(0,0);aG.x=(ak.x)?ak.x-ac.x:ac.x;if(!l){aG.y=0}else{aG.y=(ak.y)?ak.y-ac.y:ac.y}aH.x=(K)?I-aG.x/2:ac.x+aG.x/2;aH.y=aG.y/2;var aA=i-Math.atan2(aG.y,aG.x),ay=aA-Math.atan2(aH.y,aH.x),ax=Math.max(0,Math.sin(ay)*Math.sqrt(Math.pow(aH.x,2)+Math.pow(aH.y,2)));au=q(aA);at=h(ax*Math.sin(aA),ax*Math.cos(aA));if(aA>i){at.x=at.x+Math.abs(at.y*aG.y/aG.x);at.y=0;if(Math.round(at.x*Math.tan(y-aA))<J){ac.y=Math.sqrt(Math.pow(J,2)+2*aH.x*aG.x);if(O){ac.y=J-ac.y}return R()}}if(aA>i){var aE=y-aA,aF=ao-J/Math.sin(aE);P=h(Math.round(aF*Math.cos(aE)),Math.round(aF*Math.sin(aE)));if(K){P.x=-P.x}if(O){P.y=-P.y}}Q=Math.round(at.y/Math.tan(aA)+at.x);var aD=I-Q,aB=aD*Math.cos(aA*2),az=aD*Math.sin(aA*2);T=h(Math.round((K?aD-aB:Q+aB)),Math.round((O)?az:J-az));if(ap.opts.gradients){Z=aD*Math.sin(aA);var aw=A._c2.call(af,ac.corner),aC=Math.sqrt(Math.pow(aw.x-ac.x,2)+Math.pow(aw.y-ac.y,2))/I;ah=Math.sin(i*((aC>1)?2-aC:aC));aa=Math.min(aC,1);av=Z>100?(Z-100)/Z:0;N=h(Z*Math.sin(aA)/I*100,Z*Math.cos(aA)/J*100);if(A._backGradient.call(af)){M=h(Z*1.2*Math.sin(aA)/I*100,Z*1.2*Math.cos(aA)/J*100);if(!K){M.x=100-M.x}if(!O){M.y=100-M.y}}}at.x=Math.round(at.x);at.y=Math.round(at.y);return true},Y=function(aC,aB,aE,aD){var aA=["0","auto"],aG=(I-ao)*aE[0]/100,az=(J-ao)*aE[1]/100,ay={left:aA[aB[0]],top:aA[aB[1]],right:aA[aB[2]],bottom:aA[aB[3]]},ax={},aw=(aD!=90&&aD!=-90)?(K?-1:1):0,aF=aE[0]+"% "+aE[1]+"%";af.css(ay).transform(B(aD)+o(aC.x+aw,aC.y,U),aF);ar.fpage.css(ay).transform(B(aD)+o(aC.x+T.x-P.x-I*aE[0]/100,aC.y+T.y-P.y-J*aE[1]/100,U)+B((180/aD-2)*aD),aF);ar.wrapper.transform(o(-aC.x+aG-aw,-aC.y+az,U)+B(-aD),aF);ar.fwrapper.transform(o(-aC.x+P.x+aG,-aC.y+P.y+az,U)+B(-aD),aF);if(ap.opts.gradients){if(aE[0]){N.x=100-N.x}if(aE[1]){N.y=(100-N.y)}ax["box-shadow"]="0 0 20px rgba(0,0,0,"+(0.5*ah)+")";an.css(ax);b(ar.ashadow,h(K?100:0,O?0:100),h(N.x,N.y),[[av,"rgba(0,0,0,0)"],[((1-av)*0.8)+av,"rgba(0,0,0,"+(0.2*aa)+")"],[1,"rgba(255,255,255,"+(0.2*aa)+")"]],3,al);if(A._backGradient.call(af)){b(ar.bshadow,h(K?0:100,O?0:100),h(M.x,M.y),[[0.6,"rgba(0,0,0,0)"],[0.8,"rgba(0,0,0,"+(0.3*aa)+")"],[1,"rgba(0,0,0,0)"]],3)}}};switch(ac.corner){case"l":break;case"r":break;case"tl":ac.x=Math.max(ac.x,1);R();Y(at,[1,0,0,1],[100,0],au);break;case"tr":ac.x=Math.min(ac.x,I-1);R();Y(h(-at.x,at.y),[0,0,0,1],[0,0],-au);break;case"bl":ac.x=Math.max(ac.x,1);R();Y(h(at.x,-at.y),[1,1,0,0],[100,100],-au);break;case"br":ac.x=Math.min(ac.x,I-1);R();Y(h(-at.x,-at.y),[0,1,1,0],[0,100],au);break}break}ar.point=ac},_moveFoldingPage:function(K){var P=this.data().f;if(!P){return}var O=P.opts.turn,N=O.data(),J=N.pagePlace;if(K){var I=P.opts.next;if(J[I]!=P.opts.page){if(P.folding){A._moveFoldingPage.call(this,false)}var M=A._foldingPage.call(this);M.appendTo(P.fpage);J[I]=P.opts.page;P.folding=I}O.turn("update")}else{if(P.folding){if(N.pages[P.folding]){var L=N.pages[P.folding].data().f;N.pageObjs[P.folding].appendTo(L.wrapper)}else{if(N.pageWrap[P.folding]){N.pageObjs[P.folding].appendTo(N.pageWrap[P.folding])}}if(P.folding in J){J[P.folding]=P.folding}delete P.folding}}},_showFoldedPage:function(M,I){var Q=A._foldingPage.call(this),P=this.data(),K=P.f,J=K.visible;if(Q){if(!J||!K.point||K.point.corner!=M.corner){var O=(K.status=="hover"||K.status=="peel"||K.opts.turn.data().mouseAction)?M.corner:null;J=false;if(u("start",this,[K.opts,O])=="prevented"){return false}}if(I){var L=this,N=(K.point&&K.point.corner==M.corner)?K.point:A._c.call(this,M.corner,1);this.animatef({from:[N.x,N.y],to:[M.x,M.y],duration:500,frame:function(R){M.x=Math.round(R[0]);M.y=Math.round(R[1]);A._fold.call(L,M)}})}else{A._fold.call(this,M);if(P.effect&&!P.effect.turning){this.animatef(false)}}if(!J){switch(K.effect){case"hard":K.visible=true;A._moveFoldingPage.call(this,true);K.fpage.show();if(K.opts.shadows){K.bshadow.show()}break;case"sheet":K.visible=true;K.fparent.show().data().flips++;A._moveFoldingPage.call(this,true);K.fwrapper.show();if(K.bshadow){K.bshadow.show()}break}}return true}return false},hide:function(){var K=this.data().f,J=K.opts.turn.data(),I=A._foldingPage.call(this);switch(K.effect){case"hard":if(J.opts.gradients){K.bshadowLoc=0;K.bshadow.remove();K.ashadow.hide()}K.wrapper.transform("");K.fpage.hide();break;case"sheet":if((--K.fparent.data().flips)===0){K.fparent.hide()}this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("");K.wrapper.transform("");K.fwrapper.hide();if(K.bshadow){K.bshadow.hide()}I.transform("");break}K.visible=false;return this},hideFoldedPage:function(I){var J=this.data().f;if(!J.point){return}var L=this,R=J.point,K=function(){J.point=null;J.status="";L.flip("hide");L.trigger("end",[J.opts,false])};if(I){var N=A._c.call(this,R.corner),M=(R.corner.substr(0,1)=="t"),Q=(M)?Math.min(0,R.y-N.y)/2:Math.max(0,R.y-N.y)/2,P=h(R.x,R.y+Q),O=h(N.x,N.y-Q);this.animatef({from:0,to:1,frame:function(S){var T=p(R,P,O,N,S);R.x=T.x;R.y=T.y;A._fold.call(L,R)},complete:K,duration:800,hiding:true})}else{this.animatef(false);K()}},turnPage:function(L){var K=this,M=this.data().f,I=M.opts.turn.data();L={corner:(M.corner)?M.corner.corner:L||A._cAllowed.call(this)[0]};var N=M.point||A._c.call(this,L.corner,(M.opts.turn)?I.opts.elevation:0),J=A._c2.call(this,L.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(O){var P=p(N,N,J,J,O);L.x=P.x;L.y=P.y;A._showFoldedPage.call(K,L)},complete:function(){K.trigger("end",[M.opts,true])},duration:I.opts.duration,turning:true});M.corner=null},moving:function(){return"effect" in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(K){var J=this.data().f,I=J.opts.turn;if(!J.corner&&!J.disabled&&!this.flip("isTurning")&&J.opts.page==I.data().pagePlace[J.opts.page]){J.corner=A._isIArea.call(this,K);if(J.corner&&A._foldingPage.call(this)){this.trigger("pressed",[J.point]);A._showFoldedPage.call(this,J.corner);return false}else{J.corner=null}}},_eventMove:function(L){var K=this.data().f;if(!K.disabled){L=(m)?L.originalEvent.touches:[L];if(K.corner){var M=K.parent.offset();K.corner.x=L[0].pageX-M.left;K.corner.y=L[0].pageY-M.top;A._showFoldedPage.call(this,K.corner)}else{if(K.hover&&!this.data().effect&&this.is(":visible")){var I=A._isIArea.call(this,L[0]);if(I){if((K.effect=="sheet"&&I.corner.length==2)||K.effect=="hard"){K.status="hover";var J=A._c.call(this,I.corner,K.opts.cornerSize/2);I.x=J.x;I.y=J.y;A._showFoldedPage.call(this,I,true)}}else{if(K.status=="hover"){K.status="";A.hideFoldedPage.call(this,true)}}}}}},_eventEnd:function(){var J=this.data().f,I=J.corner;if(!J.disabled&&I){if(u("released",this,[J.point||I])!="prevented"){A.hideFoldedPage.call(this,true)}}J.corner=null},disable:function(I){A.setData.call(this,{disabled:I});return this},hover:function(I){A.setData.call(this,{hover:I});return this},peel:function(K,J){var L=this.data().f;if(K){if(g.inArray(K,z.all)==-1){throw E("Corner "+K+" is not permitted")}if(g.inArray(K,A._cAllowed.call(this))!=-1){var I=A._c.call(this,K,L.opts.cornerSize/2);L.status="peel";A._showFoldedPage.call(this,{corner:K,x:I.x,y:I.y},J)}}else{L.status="";A.hideFoldedPage.call(this,J)}return this}};function v(K,I,J){if(!J[0]||typeof(J[0])=="object"){return I.init.apply(K,J)}else{if(I[J[0]]){return I[J[0]].apply(K,Array.prototype.slice.call(J,1))}else{throw E(J[0]+" is not a method or property")}}}function t(K,J,L,I){return{css:{position:"absolute",top:K,left:J,overflow:I||"hidden",zIndex:L||"auto"}}}function p(O,N,M,L,K){var J=1-K,I=J*J*J,P=K*K*K;return h(Math.round(I*O.x+3*K*J*J*N.x+3*K*K*J*M.x+P*L.x),Math.round(I*O.y+3*K*J*J*N.y+3*K*K*J*M.y+P*L.y))}function H(I){return I/180*y}function q(I){return I/y*180}function h(I,J){return{x:I,y:J}}function F(){var J;if((J=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))){var I=parseFloat(J[1]);return(I>534.3)}else{return true}}function o(I,K,J){return(n&&J)?" translate3d("+I+"px,"+K+"px, 0px) ":" translate("+I+"px, "+K+"px) "}function B(I){return" rotate("+I+"deg) "}function c(J,I){return Object.prototype.hasOwnProperty.call(I,J)}function x(){var J=["Moz","Webkit","Khtml","O","ms"],I=J.length,K="";while(I--){if((J[I]+"Transform") in document.body.style){K="-"+J[I].toLowerCase()+"-"}}return K}function f(){var I,J=document.createElement("fakeelement"),K={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(I in K){if(J.style[I]!==undefined){return K[I]}}}function b(U,K,J,P,V){var Y,S=[];if(G=="-webkit-"){for(Y=0;Y<V;Y++){S.push("color-stop("+P[Y][0]+", "+P[Y][1]+")")}U.css({"background-image":"-webkit-gradient(linear, "+K.x+"% "+K.y+"%,"+J.x+"% "+J.y+"%, "+S.join(",")+" )"})}else{K={x:K.x/100*U.width(),y:K.y/100*U.height()};J={x:J.x/100*U.width(),y:J.y/100*U.height()};var T=J.x-K.x,R=J.y-K.y,Z=Math.atan2(R,T),L=Z-Math.PI/2,X=Math.abs(U.width()*Math.sin(L))+Math.abs(U.height()*Math.cos(L)),I=Math.sqrt(R*R+T*T),N=h((J.x<K.x)?U.width():0,(J.y<K.y)?U.height():0),O=Math.tan(Z),M=-1/O,Q=(M*N.x-N.y-O*K.x+K.y)/(M-O),aa={x:Q,y:M*Q-M*N.x+N.y},W=(Math.sqrt(Math.pow(aa.x-K.x,2)+Math.pow(aa.y-K.y,2)));for(Y=0;Y<V;Y++){S.push(" "+P[Y][1]+" "+((W+I*P[Y][0])*100/X)+"%")}U.css({"background-image":G+"linear-gradient("+(-Z)+"rad,"+S.join(",")+")"})}}function u(I,K,J){var L=g.Event(I);K.trigger(L,J);if(L.isDefaultPrevented()){return"prevented"}else{if(L.isPropagationStopped()){return"stopped"}else{return""}}}function E(I){function J(K){this.name="TurnJsError";this.message=K}J.prototype=new Error();J.prototype.constructor=J;return new J(I)}function w(I){var J={top:0,left:0};do{J.left+=I.offsetLeft;J.top+=I.offsetTop}while((I=I.offsetParent));return J}function k(){return(navigator.userAgent.indexOf("MSIE 9.0")==-1)}window.requestAnim=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(I){window.setTimeout(I,1000/60)}})();g.extend(g.fn,{flip:function(){return v(g(this[0]),A,arguments)},turn:function(){return v(g(this[0]),D,arguments)},transform:function(J,I){var K={};if(I){K[G+"transform-origin"]=I}K[G+"transform"]=J;return this.css(K)},animatef:function(P){var L=this.data();if(L.effect){L.effect.stop()}if(P){if(!P.to.length){P.to=[P.to]}if(!P.from.length){P.from=[P.from]}var O=[],N=P.to.length,Q=true,M=this,J=(new Date()).getTime(),I=function(){if(!L.effect||!Q){return}var R=[],T=Math.min(P.duration,(new Date()).getTime()-J);for(var S=0;S<N;S++){R.push(L.effect.easing(1,T,P.from[S],O[S],P.duration))}P.frame((N==1)?R[0]:R);if(T==P.duration){delete L.effect;M.data(L);if(P.complete){P.complete()}}else{window.requestAnim(I)}};for(var K=0;K<N;K++){O.push(P.to[K]-P.from[K])}L.effect=g.extend({stop:function(){Q=false},easing:function(S,T,R,V,U){return V*Math.sqrt(1-(T=T/U-1)*T)+R}},P);this.data(L);I()}else{delete L.effect}}});g.isTouch=m;g.mouseEvents=s;g.cssPrefix=x;g.cssTransitionEnd=f;g.findPos=w})(jQuery);